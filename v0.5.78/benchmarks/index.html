<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Benchmarks Â· SummationByPartsOperators.jl</title><meta name="title" content="Benchmarks Â· SummationByPartsOperators.jl"/><meta property="og:title" content="Benchmarks Â· SummationByPartsOperators.jl"/><meta property="twitter:title" content="Benchmarks Â· SummationByPartsOperators.jl"/><meta name="description" content="Documentation for SummationByPartsOperators.jl."/><meta property="og:description" content="Documentation for SummationByPartsOperators.jl."/><meta property="twitter:description" content="Documentation for SummationByPartsOperators.jl."/><meta property="og:url" content="https://ranocha.github.io/SummationByPartsOperators.jl/stable/benchmarks/"/><meta property="twitter:url" content="https://ranocha.github.io/SummationByPartsOperators.jl/stable/benchmarks/"/><link rel="canonical" href="https://ranocha.github.io/SummationByPartsOperators.jl/stable/benchmarks/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">SummationByPartsOperators.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../introduction/">Introduction</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../tutorials/basic_interface/">Basic interface</a></li><li><a class="tocitem" href="../tutorials/constant_linear_advection/">Linear advection equation with constant coefficients</a></li><li><a class="tocitem" href="../tutorials/advection_diffusion/">Linear advection diffusion equation with periodic boundary conditions</a></li><li><a class="tocitem" href="../tutorials/variable_linear_advection/">Linear advection equation with variable coefficients</a></li><li><a class="tocitem" href="../tutorials/wave_equation/">Wave equation</a></li><li><a class="tocitem" href="../tutorials/kdv/">Korteweg-de Vries equation</a></li><li><a class="tocitem" href="../tutorials/twodimensional_linear_advection/">Linear advection equation in two dimensions</a></li></ul></li><li><a class="tocitem" href="../ad/">Automatic differentiation (AD)</a></li><li><a class="tocitem" href="../applications/">Applications &amp; references</a></li><li class="is-active"><a class="tocitem" href>Benchmarks</a><ul class="internal"><li><a class="tocitem" href="#First-derivative-operators"><span>First-derivative operators</span></a></li><li><a class="tocitem" href="#Dissipation-operators"><span>Dissipation operators</span></a></li><li><a class="tocitem" href="#Structure-of-Arrays-(SoA)-and-Array-of-Structures-(AoS)"><span>Structure-of-Arrays (SoA) and Array-of-Structures (AoS)</span></a></li></ul></li><li><a class="tocitem" href="../api_reference/">API reference</a></li><li><a class="tocitem" href="../contributing/">Contributing</a></li><li><a class="tocitem" href="../code_of_conduct/">Code of conduct</a></li><li><a class="tocitem" href="../license/">License</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Benchmarks</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Benchmarks</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/ranocha/SummationByPartsOperators.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands">ï‚›</span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/ranocha/SummationByPartsOperators.jl/blob/main/docs/src/benchmarks.md" title="Edit source on GitHub"><span class="docs-icon fa-solid">ï„</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Benchmarks"><a class="docs-heading-anchor" href="#Benchmarks">Benchmarks</a><a id="Benchmarks-1"></a><a class="docs-heading-anchor-permalink" href="#Benchmarks" title="Permalink"></a></h1><p>Here are some simple benchmarks. Take them with a grain of salt since they run on virtual machines in the cloud to generate the documentation automatically.</p><h2 id="First-derivative-operators"><a class="docs-heading-anchor" href="#First-derivative-operators">First-derivative operators</a><a id="First-derivative-operators-1"></a><a class="docs-heading-anchor-permalink" href="#First-derivative-operators" title="Permalink"></a></h2><h4 id="Periodic-domains"><a class="docs-heading-anchor" href="#Periodic-domains">Periodic domains</a><a id="Periodic-domains-1"></a><a class="docs-heading-anchor-permalink" href="#Periodic-domains" title="Permalink"></a></h4><p>Let&#39;s set up some benchmark code.</p><pre><code class="language-julia hljs">using BenchmarkTools
using LinearAlgebra, SparseArrays
using SummationByPartsOperators

BLAS.set_num_threads(1) # make sure that BLAS is serial to be fair

T = Float64
xmin, xmax = T(0), T(1)

D_SBP = periodic_derivative_operator(derivative_order=1, accuracy_order=2,
                                     xmin=xmin, xmax=xmax, N=100)
x = grid(D_SBP)

D_sparse = sparse(D_SBP)

u = randn(eltype(D_SBP), length(x)); du = similar(u);
@show D_SBP * u â‰ˆ D_sparse * u

function doit(D, text, du, u)
  println(text)
  sleep(0.1)
  show(stdout, MIME&quot;text/plain&quot;(), @benchmark mul!($du, $D, $u))
  println()
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">doit (generic function with 1 method)</code></pre><p>First, we benchmark the implementation from SummationByPartsOperators.jl.</p><pre><code class="language-julia hljs">doit(D_SBP, &quot;D_SBP:&quot;, du, u)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">D_SBP:
BenchmarkTools.Trial: 10000 samples with 995 evaluations per sample.
 Range <span class="sgr90">(</span><span class="sgr36"><span class="sgr1">min</span></span> â€¦ <span class="sgr35">max</span><span class="sgr90">):  </span><span class="sgr36"><span class="sgr1">28.405 ns</span></span> â€¦ <span class="sgr35">56.013 ns</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>min â€¦ max<span class="sgr90">): </span>0.00% â€¦ 0.00%
 Time  <span class="sgr90">(</span><span class="sgr34"><span class="sgr1">median</span></span><span class="sgr90">):     </span><span class="sgr34"><span class="sgr1">29.079 ns              </span></span><span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>median<span class="sgr90">):    </span>0.00%
 Time  <span class="sgr90">(</span><span class="sgr32"><span class="sgr1">mean</span></span> Â± <span class="sgr32">Ïƒ</span><span class="sgr90">):   </span><span class="sgr32"><span class="sgr1">29.740 ns</span></span> Â± <span class="sgr32"> 2.507 ns</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>mean Â± Ïƒ<span class="sgr90">):  </span>0.00% Â± 0.00%

  â–…â–ˆâ–ˆ<span class="sgr34">â–ˆ</span>â–‡â–†â–…<span class="sgr32">â–ƒ</span>â–‚â–                          â–â–‚â–â–â–                   â–‚
  â–ˆâ–ˆâ–ˆ<span class="sgr34">â–ˆ</span>â–ˆâ–ˆâ–ˆ<span class="sgr32">â–ˆ</span>â–ˆâ–ˆâ–‡â–‡â–‡â–†â–„â–…â–…â–„â–ƒâ–â–ƒâ–ƒâ–ƒâ–ƒâ–â–â–â–â–â–â–„â–â–ƒâ–ƒâ–†â–‡â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‡â–‡â–‡â–‡â–†â–‡â–‡â–†â–‡â–‡â–‡â–ˆâ–ˆâ–ˆ â–ˆ
  28.4 ns<span class="sgr90">      Histogram: <span class="sgr1">log(</span>frequency<span class="sgr1">)</span> by time</span>      40.4 ns <span class="sgr1">&lt;</span>

 Memory estimate<span class="sgr90">: </span><span class="sgr33">0 bytes</span>, allocs estimate<span class="sgr90">: </span><span class="sgr33">0</span>.</code></pre><p>Next, we compare this to the runtime obtained using a sparse matrix representation of the derivative operator. Depending on the hardware etc., this can be an order of magnitude slower than the optimized implementation from SummationByPartsOperators.jl.</p><pre><code class="language-julia hljs">doit(D_sparse, &quot;D_sparse:&quot;, du, u)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">D_sparse:
BenchmarkTools.Trial: 10000 samples with 595 evaluations per sample.
 Range <span class="sgr90">(</span><span class="sgr36"><span class="sgr1">min</span></span> â€¦ <span class="sgr35">max</span><span class="sgr90">):  </span><span class="sgr36"><span class="sgr1">199.664 ns</span></span> â€¦ <span class="sgr35">530.279 ns</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>min â€¦ max<span class="sgr90">): </span>0.00% â€¦ 0.00%
 Time  <span class="sgr90">(</span><span class="sgr34"><span class="sgr1">median</span></span><span class="sgr90">):     </span><span class="sgr34"><span class="sgr1">202.576 ns               </span></span><span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>median<span class="sgr90">):    </span>0.00%
 Time  <span class="sgr90">(</span><span class="sgr32"><span class="sgr1">mean</span></span> Â± <span class="sgr32">Ïƒ</span><span class="sgr90">):   </span><span class="sgr32"><span class="sgr1">206.141 ns</span></span> Â± <span class="sgr32"> 20.461 ns</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>mean Â± Ïƒ<span class="sgr90">):  </span>0.00% Â± 0.00%

    â–†â–ˆâ–„<span class="sgr34">â–‚</span>     <span class="sgr32"> </span>                                                  
  â–â–„â–ˆâ–ˆâ–ˆ<span class="sgr34">â–ˆ</span>â–†â–…â–„â–ƒâ–‚<span class="sgr32">â–‚</span>â–‚â–‚â–â–â–â–â–â–â–â–â–‚â–ƒâ–ƒâ–‚â–‚â–‚â–‚â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â– â–‚
  200 ns<span class="sgr90">           Histogram: frequency by time</span>          237 ns <span class="sgr1">&lt;</span>

 Memory estimate<span class="sgr90">: </span><span class="sgr33">0 bytes</span>, allocs estimate<span class="sgr90">: </span><span class="sgr33">0</span>.</code></pre><p>These results were obtained using the following versions.</p><pre><code class="language-julia hljs">using InteractiveUtils
versioninfo()

using Pkg
Pkg.status([&quot;SummationByPartsOperators&quot;],
           mode=PKGMODE_MANIFEST)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Julia Version 1.6.7
Commit 3b76b25b64 (2022-07-19 15:11 UTC)
Platform Info:
  OS: Linux (x86_64-pc-linux-gnu)
  CPU: AMD EPYC 7763 64-Core Processor
  WORD_SIZE: 64
  LIBM: libopenlibm
  LLVM: libLLVM-11.0.1 (ORCJIT, generic)
Environment:
  JULIA_PKG_SERVER_REGISTRY_PREFERENCE = eager
<span class="sgr32"><span class="sgr1">      Status</span></span> `~/work/SummationByPartsOperators.jl/SummationByPartsOperators.jl/docs/Manifest.toml`
 <span class="sgr90"> [9f78cca6] </span>SummationByPartsOperators v0.5.78 `~/work/SummationByPartsOperators.jl/SummationByPartsOperators.jl`</code></pre><h4 id="Bounded-domains"><a class="docs-heading-anchor" href="#Bounded-domains">Bounded domains</a><a id="Bounded-domains-1"></a><a class="docs-heading-anchor-permalink" href="#Bounded-domains" title="Permalink"></a></h4><p>We start again by setting up some benchmark code.</p><pre><code class="language-julia hljs">using BenchmarkTools
using LinearAlgebra, SparseArrays
using SummationByPartsOperators, BandedMatrices

BLAS.set_num_threads(1) # make sure that BLAS is serial to be fair

T = Float64
xmin, xmax = T(0), T(1)

D_SBP = derivative_operator(MattssonNordstrÃ¶m2004(), derivative_order=1,
                            accuracy_order=6, xmin=xmin, xmax=xmax, N=10^3)
D_sparse = sparse(D_SBP)
D_banded = BandedMatrix(D_SBP)

u = randn(eltype(D_SBP), size(D_SBP, 1)); du = similar(u);
@show D_SBP * u â‰ˆ D_sparse * u â‰ˆ D_banded * u

function doit(D, text, du, u)
  println(text)
  sleep(0.1)
  show(stdout, MIME&quot;text/plain&quot;(), @benchmark mul!($du, $D, $u))
  println()
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">doit (generic function with 1 method)</code></pre><p>First, we benchmark the implementation from SummationByPartsOperators.jl.</p><pre><code class="language-julia hljs">doit(D_SBP, &quot;D_SBP:&quot;, du, u)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">D_SBP:
BenchmarkTools.Trial: 10000 samples with 203 evaluations per sample.
 Range <span class="sgr90">(</span><span class="sgr36"><span class="sgr1">min</span></span> â€¦ <span class="sgr35">max</span><span class="sgr90">):  </span><span class="sgr36"><span class="sgr1">388.458 ns</span></span> â€¦ <span class="sgr35">949.892 ns</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>min â€¦ max<span class="sgr90">): </span>0.00% â€¦ 0.00%
 Time  <span class="sgr90">(</span><span class="sgr34"><span class="sgr1">median</span></span><span class="sgr90">):     </span><span class="sgr34"><span class="sgr1">392.448 ns               </span></span><span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>median<span class="sgr90">):    </span>0.00%
 Time  <span class="sgr90">(</span><span class="sgr32"><span class="sgr1">mean</span></span> Â± <span class="sgr32">Ïƒ</span><span class="sgr90">):   </span><span class="sgr32"><span class="sgr1">397.167 ns</span></span> Â± <span class="sgr32"> 17.235 ns</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>mean Â± Ïƒ<span class="sgr90">):  </span>0.00% Â± 0.00%

  â–‚â–‡â–ˆ<span class="sgr34">â–‡</span>â–…â–ƒ<span class="sgr32">â–‚</span>                   â–‚â–ƒâ–ƒâ–‚â–                               â–‚
  â–ˆâ–ˆâ–ˆ<span class="sgr34">â–ˆ</span>â–ˆâ–ˆ<span class="sgr32">â–ˆ</span>â–†â–†â–‡â–ˆâ–‡â–…â–â–ƒâ–â–ƒâ–â–â–ƒâ–„â–ƒâ–â–ƒâ–ƒâ–†â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‡â–‡â–†â–…â–„â–â–â–ƒâ–â–â–†â–†â–†â–„â–†â–†â–†â–†â–†â–†â–…â–†â–…â–„â–…â–…â–„â–…â–† â–ˆ
  388 ns<span class="sgr90">        Histogram: <span class="sgr1">log(</span>frequency<span class="sgr1">)</span> by time</span>        473 ns <span class="sgr1">&lt;</span>

 Memory estimate<span class="sgr90">: </span><span class="sgr33">0 bytes</span>, allocs estimate<span class="sgr90">: </span><span class="sgr33">0</span>.</code></pre><p>Again, we compare this to a representation of the derivative operator as a sparse matrix. No surprise - it is again much slower, as in periodic domains.</p><pre><code class="language-julia hljs">doit(D_sparse, &quot;D_sparse:&quot;, du, u)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">D_sparse:
BenchmarkTools.Trial: 10000 samples with 7 evaluations per sample.
 Range <span class="sgr90">(</span><span class="sgr36"><span class="sgr1">min</span></span> â€¦ <span class="sgr35">max</span><span class="sgr90">):  </span><span class="sgr36"><span class="sgr1">4.692 Î¼s</span></span> â€¦ <span class="sgr35"> 12.102 Î¼s</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>min â€¦ max<span class="sgr90">): </span>0.00% â€¦ 0.00%
 Time  <span class="sgr90">(</span><span class="sgr34"><span class="sgr1">median</span></span><span class="sgr90">):     </span><span class="sgr34"><span class="sgr1">4.730 Î¼s               </span></span><span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>median<span class="sgr90">):    </span>0.00%
 Time  <span class="sgr90">(</span><span class="sgr32"><span class="sgr1">mean</span></span> Â± <span class="sgr32">Ïƒ</span><span class="sgr90">):   </span><span class="sgr32"><span class="sgr1">4.787 Î¼s</span></span> Â± <span class="sgr32">328.958 ns</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>mean Â± Ïƒ<span class="sgr90">):  </span>0.00% Â± 0.00%

  â–„â–ˆ<span class="sgr34">â–‡</span>  <span class="sgr32"> </span>â–â–                                           â–â–       â–
  â–ˆâ–ˆ<span class="sgr34">â–ˆ</span>â–ˆâ–„<span class="sgr32">â–…</span>â–ˆâ–ˆâ–„â–â–â–â–â–…â–†â–†â–„â–„â–„â–â–â–â–â–â–ƒâ–â–â–â–â–â–ƒâ–â–â–â–â–â–â–â–â–ƒâ–â–â–â–â–â–â–ƒâ–ƒâ–„â–‡â–ˆâ–ˆâ–ˆâ–‡â–†â–†â–†â–…â–… â–ˆ
  4.69 Î¼s<span class="sgr90">      Histogram: <span class="sgr1">log(</span>frequency<span class="sgr1">)</span> by time</span>      5.93 Î¼s <span class="sgr1">&lt;</span>

 Memory estimate<span class="sgr90">: </span><span class="sgr33">0 bytes</span>, allocs estimate<span class="sgr90">: </span><span class="sgr33">0</span>.</code></pre><p>FInally, we compare it to a representation as banded matrix. Disappointingly, this is still much slower than the optimized implementation from SummationByPartsOperators.jl.</p><pre><code class="language-julia hljs">doit(D_banded, &quot;D_banded:&quot;, du, u)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">D_banded:
BenchmarkTools.Trial: 10000 samples with 5 evaluations per sample.
 Range <span class="sgr90">(</span><span class="sgr36"><span class="sgr1">min</span></span> â€¦ <span class="sgr35">max</span><span class="sgr90">):  </span><span class="sgr36"><span class="sgr1">6.694 Î¼s</span></span> â€¦ <span class="sgr35">42.625 Î¼s</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>min â€¦ max<span class="sgr90">): </span>0.00% â€¦ 0.00%
 Time  <span class="sgr90">(</span><span class="sgr34"><span class="sgr1">median</span></span><span class="sgr90">):     </span><span class="sgr34"><span class="sgr1">6.725 Î¼s              </span></span><span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>median<span class="sgr90">):    </span>0.00%
 Time  <span class="sgr90">(</span><span class="sgr32"><span class="sgr1">mean</span></span> Â± <span class="sgr32">Ïƒ</span><span class="sgr90">):   </span><span class="sgr32"><span class="sgr1">7.004 Î¼s</span></span> Â± <span class="sgr32"> 1.400 Î¼s</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>mean Â± Ïƒ<span class="sgr90">):  </span>0.00% Â± 0.00%

  <span class="sgr34">â–ˆ</span>â–‚ <span class="sgr32"> </span>         â–â–                                            â–
  <span class="sgr34">â–ˆ</span>â–ˆâ–‡<span class="sgr32">â–†</span>â–‡â–…â–ƒâ–„â–…â–„â–„â–…â–…â–ˆâ–ˆâ–‡â–‡â–‡â–‡â–†â–„â–„â–„â–†â–ƒâ–„â–…â–„â–â–„â–„â–„â–„â–„â–ƒâ–„â–ƒâ–ƒâ–…â–…â–…â–†â–‡â–†â–…â–…â–…â–…â–…â–…â–„â–„â–†â–…â–†â–‡â–‡â–‡ â–ˆ
  6.69 Î¼s<span class="sgr90">      Histogram: <span class="sgr1">log(</span>frequency<span class="sgr1">)</span> by time</span>       13 Î¼s <span class="sgr1">&lt;</span>

 Memory estimate<span class="sgr90">: </span><span class="sgr33">0 bytes</span>, allocs estimate<span class="sgr90">: </span><span class="sgr33">0</span>.</code></pre><p>These results were obtained using the following versions.</p><pre><code class="language-julia hljs">using InteractiveUtils
versioninfo()

using Pkg
Pkg.status([&quot;SummationByPartsOperators&quot;, &quot;BandedMatrices&quot;],
           mode=PKGMODE_MANIFEST)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Julia Version 1.6.7
Commit 3b76b25b64 (2022-07-19 15:11 UTC)
Platform Info:
  OS: Linux (x86_64-pc-linux-gnu)
  CPU: AMD EPYC 7763 64-Core Processor
  WORD_SIZE: 64
  LIBM: libopenlibm
  LLVM: libLLVM-11.0.1 (ORCJIT, generic)
Environment:
  JULIA_PKG_SERVER_REGISTRY_PREFERENCE = eager
<span class="sgr32"><span class="sgr1">      Status</span></span> `~/work/SummationByPartsOperators.jl/SummationByPartsOperators.jl/docs/Manifest.toml`
 <span class="sgr90"> [aae01518] </span>BandedMatrices v1.7.6
 <span class="sgr90"> [9f78cca6] </span>SummationByPartsOperators v0.5.78 `~/work/SummationByPartsOperators.jl/SummationByPartsOperators.jl`</code></pre><h2 id="Dissipation-operators"><a class="docs-heading-anchor" href="#Dissipation-operators">Dissipation operators</a><a id="Dissipation-operators-1"></a><a class="docs-heading-anchor-permalink" href="#Dissipation-operators" title="Permalink"></a></h2><p>We follow the same structure as before. At first, we set up some benchmark code.</p><pre><code class="language-julia hljs">using BenchmarkTools
using LinearAlgebra, SparseArrays
using SummationByPartsOperators, BandedMatrices

BLAS.set_num_threads(1) # make sure that BLAS is serial to be fair

T = Float64
xmin, xmax = T(0), T(1)

D_SBP = derivative_operator(MattssonNordstrÃ¶m2004(), derivative_order=1,
                            accuracy_order=6, xmin=xmin, xmax=xmax, N=10^3)
Di_SBP  = dissipation_operator(MattssonSvÃ¤rdNordstrÃ¶m2004(), D_SBP)
Di_sparse = sparse(Di_SBP)
Di_banded = BandedMatrix(Di_SBP)
Di_full   = Matrix(Di_SBP)

u = randn(eltype(D_SBP), size(D_SBP, 1)); du = similar(u);
@show Di_SBP * u â‰ˆ Di_sparse * u â‰ˆ Di_banded * u â‰ˆ Di_full * u

function doit(D, text, du, u)
  println(text)
  sleep(0.1)
  show(stdout, MIME&quot;text/plain&quot;(), @benchmark mul!($du, $D, $u))
  println()
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">doit (generic function with 1 method)</code></pre><p>At first, let us benchmark the derivative and dissipation operators implemented in SummationByPartsOperators.jl.</p><pre><code class="language-julia hljs">doit(D_SBP, &quot;D_SBP:&quot;, du, u)
doit(Di_SBP, &quot;Di_SBP:&quot;, du, u)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">D_SBP:
BenchmarkTools.Trial: 10000 samples with 202 evaluations per sample.
 Range <span class="sgr90">(</span><span class="sgr36"><span class="sgr1">min</span></span> â€¦ <span class="sgr35">max</span><span class="sgr90">):  </span><span class="sgr36"><span class="sgr1">388.094 ns</span></span> â€¦ <span class="sgr35">699.366 ns</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>min â€¦ max<span class="sgr90">): </span>0.00% â€¦ 0.00%
 Time  <span class="sgr90">(</span><span class="sgr34"><span class="sgr1">median</span></span><span class="sgr90">):     </span><span class="sgr34"><span class="sgr1">392.213 ns               </span></span><span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>median<span class="sgr90">):    </span>0.00%
 Time  <span class="sgr90">(</span><span class="sgr32"><span class="sgr1">mean</span></span> Â± <span class="sgr32">Ïƒ</span><span class="sgr90">):   </span><span class="sgr32"><span class="sgr1">396.380 ns</span></span> Â± <span class="sgr32"> 17.179 ns</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>mean Â± Ïƒ<span class="sgr90">):  </span>0.00% Â± 0.00%

     â–†â–ˆ<span class="sgr34">â–„</span>   <span class="sgr32"> </span>                                                    
  â–‚â–ƒâ–‡â–ˆâ–ˆ<span class="sgr34">â–ˆ</span>â–‡â–„â–ƒ<span class="sgr32">â–‚</span>â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–â–â–â–â–‚â–â–â–â–â–â–‚â–‚â–â–â–‚â–â–â–â–â–‚â–‚â–‚â–ƒâ–ƒâ–ƒâ–ƒâ–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚ â–ƒ
  388 ns<span class="sgr90">           Histogram: frequency by time</span>          441 ns <span class="sgr1">&lt;</span>

 Memory estimate<span class="sgr90">: </span><span class="sgr33">0 bytes</span>, allocs estimate<span class="sgr90">: </span><span class="sgr33">0</span>.
Di_SBP:
BenchmarkTools.Trial: 10000 samples with 10 evaluations per sample.
 Range <span class="sgr90">(</span><span class="sgr36"><span class="sgr1">min</span></span> â€¦ <span class="sgr35">max</span><span class="sgr90">):  </span><span class="sgr36"><span class="sgr1">1.013 Î¼s</span></span> â€¦ <span class="sgr35"> 2.709 Î¼s</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>min â€¦ max<span class="sgr90">): </span>0.00% â€¦ 0.00%
 Time  <span class="sgr90">(</span><span class="sgr34"><span class="sgr1">median</span></span><span class="sgr90">):     </span><span class="sgr34"><span class="sgr1">1.021 Î¼s              </span></span><span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>median<span class="sgr90">):    </span>0.00%
 Time  <span class="sgr90">(</span><span class="sgr32"><span class="sgr1">mean</span></span> Â± <span class="sgr32">Ïƒ</span><span class="sgr90">):   </span><span class="sgr32"><span class="sgr1">1.032 Î¼s</span></span> Â± <span class="sgr32">83.881 ns</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>mean Â± Ïƒ<span class="sgr90">):  </span>0.00% Â± 0.00%

  â–ˆ<span class="sgr34"> </span><span class="sgr32"> </span>                                                        
  â–ˆ<span class="sgr34">â–…</span><span class="sgr32">â–‚</span>â–‚â–â–â–‚â–‚â–‚â–‚â–â–â–â–‚â–â–‚â–‚â–‚â–‚â–â–‚â–â–â–â–â–â–â–â–‚â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–‚â–‚ â–‚
  1.01 Î¼s<span class="sgr90">        Histogram: frequency by time</span>        1.73 Î¼s <span class="sgr1">&lt;</span>

 Memory estimate<span class="sgr90">: </span><span class="sgr33">0 bytes</span>, allocs estimate<span class="sgr90">: </span><span class="sgr33">0</span>.</code></pre><p>Next, we compare the results to sparse matrix representations. It will not come as a surprise that these are again much (around an order of magnitude) slower.</p><pre><code class="language-julia hljs">doit(Di_sparse, &quot;Di_sparse:&quot;, du, u)
doit(Di_banded, &quot;Di_banded:&quot;, du, u)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Di_sparse:
BenchmarkTools.Trial: 10000 samples with 6 evaluations per sample.
 Range <span class="sgr90">(</span><span class="sgr36"><span class="sgr1">min</span></span> â€¦ <span class="sgr35">max</span><span class="sgr90">):  </span><span class="sgr36"><span class="sgr1">5.570 Î¼s</span></span> â€¦ <span class="sgr35"> 11.580 Î¼s</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>min â€¦ max<span class="sgr90">): </span>0.00% â€¦ 0.00%
 Time  <span class="sgr90">(</span><span class="sgr34"><span class="sgr1">median</span></span><span class="sgr90">):     </span><span class="sgr34"><span class="sgr1">5.667 Î¼s               </span></span><span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>median<span class="sgr90">):    </span>0.00%
 Time  <span class="sgr90">(</span><span class="sgr32"><span class="sgr1">mean</span></span> Â± <span class="sgr32">Ïƒ</span><span class="sgr90">):   </span><span class="sgr32"><span class="sgr1">5.729 Î¼s</span></span> Â± <span class="sgr32">323.804 ns</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>mean Â± Ïƒ<span class="sgr90">):  </span>0.00% Â± 0.00%

  â–â–…â–‡â–ˆ<span class="sgr34">â–ˆ</span>â–†<span class="sgr32">â–„</span>â–â–â–                                          â–â–â–â–    â–‚
  â–ˆâ–ˆâ–ˆâ–ˆ<span class="sgr34">â–ˆ</span>â–ˆ<span class="sgr32">â–ˆ</span>â–ˆâ–ˆâ–ˆâ–ˆâ–†â–„â–ƒâ–ƒâ–„â–†â–†â–…â–„â–â–ƒâ–„â–ƒâ–ƒâ–â–ƒâ–â–â–â–â–â–â–â–â–â–â–â–â–â–ƒâ–â–â–â–â–â–ƒâ–â–ƒâ–…â–†â–‡â–ˆâ–ˆâ–ˆâ–ˆâ–‡â–†â–† â–ˆ
  5.57 Î¼s<span class="sgr90">      Histogram: <span class="sgr1">log(</span>frequency<span class="sgr1">)</span> by time</span>      7.02 Î¼s <span class="sgr1">&lt;</span>

 Memory estimate<span class="sgr90">: </span><span class="sgr33">0 bytes</span>, allocs estimate<span class="sgr90">: </span><span class="sgr33">0</span>.
Di_banded:
BenchmarkTools.Trial: 10000 samples with 5 evaluations per sample.
 Range <span class="sgr90">(</span><span class="sgr36"><span class="sgr1">min</span></span> â€¦ <span class="sgr35">max</span><span class="sgr90">):  </span><span class="sgr36"><span class="sgr1">6.226 Î¼s</span></span> â€¦ <span class="sgr35"> 13.539 Î¼s</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>min â€¦ max<span class="sgr90">): </span>0.00% â€¦ 0.00%
 Time  <span class="sgr90">(</span><span class="sgr34"><span class="sgr1">median</span></span><span class="sgr90">):     </span><span class="sgr34"><span class="sgr1">6.266 Î¼s               </span></span><span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>median<span class="sgr90">):    </span>0.00%
 Time  <span class="sgr90">(</span><span class="sgr32"><span class="sgr1">mean</span></span> Â± <span class="sgr32">Ïƒ</span><span class="sgr90">):   </span><span class="sgr32"><span class="sgr1">6.472 Î¼s</span></span> Â± <span class="sgr32">471.714 ns</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>mean Â± Ïƒ<span class="sgr90">):  </span>0.00% Â± 0.00%

  â–ˆ<span class="sgr34">â–ˆ</span>   â–‚ <span class="sgr32"> </span> â–        â–†â–…                                        â–‚
  â–ˆ<span class="sgr34">â–ˆ</span>â–†â–„â–‡â–ˆâ–†<span class="sgr32">â–ƒ</span>â–ˆâ–ˆâ–…â–„â–…â–†â–†â–…â–„â–„â–ˆâ–ˆâ–„â–ƒâ–…â–ˆâ–â–„â–â–ƒâ–â–„â–…â–…â–„â–„â–ƒâ–â–ƒâ–â–„â–†â–‡â–ˆâ–ˆâ–‡â–†â–†â–†â–†â–‡â–†â–†â–†â–…â–…â–…â–†â–†â–†â–‡ â–ˆ
  6.23 Î¼s<span class="sgr90">      Histogram: <span class="sgr1">log(</span>frequency<span class="sgr1">)</span> by time</span>      8.33 Î¼s <span class="sgr1">&lt;</span>

 Memory estimate<span class="sgr90">: </span><span class="sgr33">0 bytes</span>, allocs estimate<span class="sgr90">: </span><span class="sgr33">0</span>.</code></pre><p>Finally, let&#39;s benchmark the same computation if a full (dense) matrix is used to represent the derivative operator. This is obviously a bad idea but ğŸ¤·</p><pre><code class="language-julia hljs">doit(Di_full, &quot;Di_full:&quot;, du, u)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Di_full:
BenchmarkTools.Trial: 10000 samples with 1 evaluation per sample.
 Range <span class="sgr90">(</span><span class="sgr36"><span class="sgr1">min</span></span> â€¦ <span class="sgr35">max</span><span class="sgr90">):  </span><span class="sgr36"><span class="sgr1">150.039 Î¼s</span></span> â€¦ <span class="sgr35">327.548 Î¼s</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>min â€¦ max<span class="sgr90">): </span>0.00% â€¦ 0.00%
 Time  <span class="sgr90">(</span><span class="sgr34"><span class="sgr1">median</span></span><span class="sgr90">):     </span><span class="sgr34"><span class="sgr1">155.654 Î¼s               </span></span><span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>median<span class="sgr90">):    </span>0.00%
 Time  <span class="sgr90">(</span><span class="sgr32"><span class="sgr1">mean</span></span> Â± <span class="sgr32">Ïƒ</span><span class="sgr90">):   </span><span class="sgr32"><span class="sgr1">156.847 Î¼s</span></span> Â± <span class="sgr32">  6.127 Î¼s</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>mean Â± Ïƒ<span class="sgr90">):  </span>0.00% Â± 0.00%

     â–„â–ˆâ–‚       <span class="sgr34"> </span>  <span class="sgr32"> </span>                                             
  â–â–â–„â–ˆâ–ˆâ–ˆâ–†â–„â–ƒâ–ƒâ–ƒâ–‚â–ƒ<span class="sgr34">â–ƒ</span>â–ƒâ–„<span class="sgr32">â–…</span>â–…â–…â–…â–„â–ƒâ–‚â–ƒâ–„â–„â–ƒâ–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â– â–‚
  150 Î¼s<span class="sgr90">           Histogram: frequency by time</span>          177 Î¼s <span class="sgr1">&lt;</span>

 Memory estimate<span class="sgr90">: </span><span class="sgr33">0 bytes</span>, allocs estimate<span class="sgr90">: </span><span class="sgr33">0</span>.</code></pre><p>These results were obtained using the following versions.</p><pre><code class="language-julia hljs">using InteractiveUtils
versioninfo()

using Pkg
Pkg.status([&quot;SummationByPartsOperators&quot;, &quot;BandedMatrices&quot;],
           mode=PKGMODE_MANIFEST)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Julia Version 1.6.7
Commit 3b76b25b64 (2022-07-19 15:11 UTC)
Platform Info:
  OS: Linux (x86_64-pc-linux-gnu)
  CPU: AMD EPYC 7763 64-Core Processor
  WORD_SIZE: 64
  LIBM: libopenlibm
  LLVM: libLLVM-11.0.1 (ORCJIT, generic)
Environment:
  JULIA_PKG_SERVER_REGISTRY_PREFERENCE = eager
<span class="sgr32"><span class="sgr1">      Status</span></span> `~/work/SummationByPartsOperators.jl/SummationByPartsOperators.jl/docs/Manifest.toml`
 <span class="sgr90"> [aae01518] </span>BandedMatrices v1.7.6
 <span class="sgr90"> [9f78cca6] </span>SummationByPartsOperators v0.5.78 `~/work/SummationByPartsOperators.jl/SummationByPartsOperators.jl`</code></pre><h2 id="Structure-of-Arrays-(SoA)-and-Array-of-Structures-(AoS)"><a class="docs-heading-anchor" href="#Structure-of-Arrays-(SoA)-and-Array-of-Structures-(AoS)">Structure-of-Arrays (SoA) and Array-of-Structures (AoS)</a><a id="Structure-of-Arrays-(SoA)-and-Array-of-Structures-(AoS)-1"></a><a class="docs-heading-anchor-permalink" href="#Structure-of-Arrays-(SoA)-and-Array-of-Structures-(AoS)" title="Permalink"></a></h2><p><a href="https://github.com/ranocha/SummationByPartsOperators.jl">SummationByPartsOperators.jl</a> tries to provide efficient support of</p><ul><li><code>StaticVector</code>s from <a href="https://github.com/JuliaArrays/StaticArrays.jl">StaticArrays.jl</a></li><li><a href="https://github.com/JuliaArrays/StructArrays.jl">StructArrays.jl</a></li></ul><p>To demonstrate this, let us set up some benchmark code.</p><pre><code class="language-julia hljs">using BenchmarkTools
using StaticArrays, StructArrays
using LinearAlgebra, SparseArrays
using SummationByPartsOperators

BLAS.set_num_threads(1) # make sure that BLAS is serial to be fair

struct Vec5{T} &lt;: FieldVector{5,T}
  x1::T
  x2::T
  x3::T
  x4::T
  x5::T
end

# Apply `mul!` to each component of a plain array of structures one after another
function mul_aos!(du, D, u, args...)
  for i in 1:size(du, 1)
    mul!(view(du, i, :), D, view(u, i, :), args...)
  end
end

T = Float64
xmin, xmax = T(0), T(1)

D_SBP = derivative_operator(MattssonNordstrÃ¶m2004(), derivative_order=1,
                            accuracy_order=4, xmin=xmin, xmax=xmax, N=101)
D_sparse = sparse(D_SBP)
D_full   = Matrix(D_SBP)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">101Ã—101 Matrix{Float64}:
 -141.176    173.529   -23.5294   â€¦    0.0         0.0       0.0
  -50.0        0.0      50.0           0.0         0.0       0.0
    9.30233  -68.6047    0.0           0.0         0.0       0.0
    3.06122    0.0     -60.2041        0.0         0.0       0.0
    0.0        0.0       8.33333       0.0         0.0       0.0
    0.0        0.0       0.0      â€¦    0.0         0.0       0.0
    0.0        0.0       0.0           0.0         0.0       0.0
    0.0        0.0       0.0           0.0         0.0       0.0
    0.0        0.0       0.0           0.0         0.0       0.0
    0.0        0.0       0.0           0.0         0.0       0.0
    â‹®                             â‹±                          â‹®
    0.0        0.0       0.0           0.0         0.0       0.0
    0.0        0.0       0.0           0.0         0.0       0.0
    0.0        0.0       0.0           0.0         0.0       0.0
    0.0        0.0       0.0      â€¦    0.0         0.0       0.0
    0.0        0.0       0.0          -8.33333     0.0       0.0
    0.0        0.0       0.0          60.2041      0.0      -3.06122
    0.0        0.0       0.0           0.0        68.6047   -9.30233
    0.0        0.0       0.0         -50.0         0.0      50.0
    0.0        0.0       0.0      â€¦   23.5294   -173.529   141.176</code></pre><p>At first, we benchmark the application of the operators implemented in SummationByPartsOperators.jl and their representations as sparse and dense matrices in the scalar case. As before, the sparse matrix representation is around an order of magnitude slower and the dense matrix representation is far off.</p><pre><code class="language-julia hljs">println(&quot;Scalar case&quot;)
u = randn(T, size(D_SBP, 1)); du = similar(u)
println(&quot;D_SBP&quot;)
show(stdout, MIME&quot;text/plain&quot;(), @benchmark mul!($du, $D_SBP, $u))
println(&quot;\nD_sparse&quot;)
show(stdout, MIME&quot;text/plain&quot;(), @benchmark mul!($du, $D_sparse, $u))
println(&quot;\nD_full&quot;)
show(stdout, MIME&quot;text/plain&quot;(), @benchmark mul!($du, $D_full, $u))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Scalar case
D_SBP
BenchmarkTools.Trial: 10000 samples with 989 evaluations per sample.
 Range <span class="sgr90">(</span><span class="sgr36"><span class="sgr1">min</span></span> â€¦ <span class="sgr35">max</span><span class="sgr90">):  </span><span class="sgr36"><span class="sgr1">44.207 ns</span></span> â€¦ <span class="sgr35">319.724 ns</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>min â€¦ max<span class="sgr90">): </span>0.00% â€¦ 0.00%
 Time  <span class="sgr90">(</span><span class="sgr34"><span class="sgr1">median</span></span><span class="sgr90">):     </span><span class="sgr34"><span class="sgr1">46.010 ns               </span></span><span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>median<span class="sgr90">):    </span>0.00%
 Time  <span class="sgr90">(</span><span class="sgr32"><span class="sgr1">mean</span></span> Â± <span class="sgr32">Ïƒ</span><span class="sgr90">):   </span><span class="sgr32"><span class="sgr1">48.886 ns</span></span> Â± <span class="sgr32"> 13.814 ns</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>mean Â± Ïƒ<span class="sgr90">):  </span>0.00% Â± 0.00%

   â–ˆ<span class="sgr34">â–‡</span>â–‚ <span class="sgr32"> </span>  â–â–ƒ           â–                                       â–
  â–‡â–ˆ<span class="sgr34">â–ˆ</span>â–ˆâ–‡<span class="sgr32">â–†</span>â–†â–…â–ˆâ–ˆâ–ˆâ–†â–†â–†â–ˆâ–‡â–ˆâ–‡â–‡â–‡â–‡â–ˆâ–…â–ƒâ–„â–…â–„â–„â–„â–„â–„â–…â–â–„â–â–ƒâ–„â–â–„â–„â–…â–„â–„â–…â–†â–†â–†â–…â–†â–†â–†â–†â–†â–†â–†â–†â–‡â–‡â–†â–† â–ˆ
  44.2 ns<span class="sgr90">       Histogram: <span class="sgr1">log(</span>frequency<span class="sgr1">)</span> by time</span>       102 ns <span class="sgr1">&lt;</span>

 Memory estimate<span class="sgr90">: </span><span class="sgr33">0 bytes</span>, allocs estimate<span class="sgr90">: </span><span class="sgr33">0</span>.
D_sparse
BenchmarkTools.Trial: 10000 samples with 221 evaluations per sample.
 Range <span class="sgr90">(</span><span class="sgr36"><span class="sgr1">min</span></span> â€¦ <span class="sgr35">max</span><span class="sgr90">):  </span><span class="sgr36"><span class="sgr1">334.516 ns</span></span> â€¦ <span class="sgr35">638.833 ns</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>min â€¦ max<span class="sgr90">): </span>0.00% â€¦ 0.00%
 Time  <span class="sgr90">(</span><span class="sgr34"><span class="sgr1">median</span></span><span class="sgr90">):     </span><span class="sgr34"><span class="sgr1">340.136 ns               </span></span><span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>median<span class="sgr90">):    </span>0.00%
 Time  <span class="sgr90">(</span><span class="sgr32"><span class="sgr1">mean</span></span> Â± <span class="sgr32">Ïƒ</span><span class="sgr90">):   </span><span class="sgr32"><span class="sgr1">343.792 ns</span></span> Â± <span class="sgr32"> 13.825 ns</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>mean Â± Ïƒ<span class="sgr90">):  </span>0.00% Â± 0.00%

      â–„â–ˆâ–ˆ<span class="sgr34">â–…</span>â–ƒâ–  <span class="sgr32"> </span>                                                 
  â–‚â–‚â–ƒâ–…â–ˆâ–ˆâ–ˆ<span class="sgr34">â–ˆ</span>â–ˆâ–ˆâ–‡â–†<span class="sgr32">â–…</span>â–„â–ƒâ–ƒâ–ƒâ–ƒâ–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–â–‚â–â–â–‚â–‚â–‚â–ƒâ–ƒâ–ƒâ–ƒâ–ƒâ–ƒâ–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚ â–ƒ
  335 ns<span class="sgr90">           Histogram: frequency by time</span>          381 ns <span class="sgr1">&lt;</span>

 Memory estimate<span class="sgr90">: </span><span class="sgr33">0 bytes</span>, allocs estimate<span class="sgr90">: </span><span class="sgr33">0</span>.
D_full
BenchmarkTools.Trial: 10000 samples with 10 evaluations per sample.
 Range <span class="sgr90">(</span><span class="sgr36"><span class="sgr1">min</span></span> â€¦ <span class="sgr35">max</span><span class="sgr90">):  </span><span class="sgr36"><span class="sgr1">1.709 Î¼s</span></span> â€¦ <span class="sgr35">  4.318 Î¼s</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>min â€¦ max<span class="sgr90">): </span>0.00% â€¦ 0.00%
 Time  <span class="sgr90">(</span><span class="sgr34"><span class="sgr1">median</span></span><span class="sgr90">):     </span><span class="sgr34"><span class="sgr1">1.720 Î¼s               </span></span><span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>median<span class="sgr90">):    </span>0.00%
 Time  <span class="sgr90">(</span><span class="sgr32"><span class="sgr1">mean</span></span> Â± <span class="sgr32">Ïƒ</span><span class="sgr90">):   </span><span class="sgr32"><span class="sgr1">1.785 Î¼s</span></span> Â± <span class="sgr32">229.894 ns</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>mean Â± Ïƒ<span class="sgr90">):  </span>0.00% Â± 0.00%

  â–ˆ<span class="sgr34">â–…</span>  <span class="sgr32"> </span>                                      â–                â–
  â–ˆ<span class="sgr34">â–ˆ</span>â–†â–„<span class="sgr32">â–…</span>â–‡â–â–â–â–â–â–†â–„â–„â–ƒâ–ƒâ–â–ƒâ–ƒâ–ƒâ–â–â–â–ƒâ–â–â–â–ƒâ–†â–ˆâ–‡â–†â–†â–‡â–‡â–‡â–…â–†â–ˆâ–†â–…â–†â–ˆâ–ˆâ–ˆâ–‡â–†â–†â–†â–†â–†â–‡â–‡â–‡â–†â–‡â–‡â–‡â–ˆ â–ˆ
  1.71 Î¼s<span class="sgr90">      Histogram: <span class="sgr1">log(</span>frequency<span class="sgr1">)</span> by time</span>      2.72 Î¼s <span class="sgr1">&lt;</span>

 Memory estimate<span class="sgr90">: </span><span class="sgr33">0 bytes</span>, allocs estimate<span class="sgr90">: </span><span class="sgr33">0</span>.</code></pre><p>Next, we use a plain array of structures (AoS) in the form of a two-dimensional array and our custom <code>mul_aos!</code> implementation that loops over each component, using <code>mul!</code> on <code>view</code>s. Here, the differences between the timings are less pronounced.</p><pre><code class="language-julia hljs">println(&quot;Plain Array of Structures&quot;)
u_aos_plain = randn(T, 5, size(D_SBP, 1)); du_aos_plain = similar(u_aos_plain)
println(&quot;D_SBP&quot;)
show(stdout, MIME&quot;text/plain&quot;(), @benchmark mul_aos!($du_aos_plain, $D_SBP, $u_aos_plain))
println(&quot;\nD_sparse&quot;)
show(stdout, MIME&quot;text/plain&quot;(), @benchmark mul_aos!($du_aos_plain, $D_sparse, $u_aos_plain))
println(&quot;\nD_full&quot;)
show(stdout, MIME&quot;text/plain&quot;(), @benchmark mul_aos!($du_aos_plain, $D_full, $u_aos_plain))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Plain Array of Structures
D_SBP
BenchmarkTools.Trial: 10000 samples with 10 evaluations per sample.
 Range <span class="sgr90">(</span><span class="sgr36"><span class="sgr1">min</span></span> â€¦ <span class="sgr35">max</span><span class="sgr90">):  </span><span class="sgr36"><span class="sgr1">1.310 Î¼s</span></span> â€¦ <span class="sgr35">  2.922 Î¼s</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>min â€¦ max<span class="sgr90">): </span>0.00% â€¦ 0.00%
 Time  <span class="sgr90">(</span><span class="sgr34"><span class="sgr1">median</span></span><span class="sgr90">):     </span><span class="sgr34"><span class="sgr1">1.321 Î¼s               </span></span><span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>median<span class="sgr90">):    </span>0.00%
 Time  <span class="sgr90">(</span><span class="sgr32"><span class="sgr1">mean</span></span> Â± <span class="sgr32">Ïƒ</span><span class="sgr90">):   </span><span class="sgr32"><span class="sgr1">1.337 Î¼s</span></span> Â± <span class="sgr32">105.783 ns</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>mean Â± Ïƒ<span class="sgr90">):  </span>0.00% Â± 0.00%

  â–ˆ<span class="sgr34">â–ˆ</span><span class="sgr32"> </span>                                                         â–
  â–ˆ<span class="sgr34">â–ˆ</span><span class="sgr32">â–‡</span>â–ƒâ–„â–„â–…â–ˆâ–„â–„â–„â–„â–ƒâ–ƒâ–„â–…â–…â–„â–…â–„â–…â–„â–…â–„â–„â–…â–ƒâ–…â–…â–„â–„â–„â–…â–…â–â–…â–â–â–„â–â–„â–„â–„â–ƒâ–„â–ƒâ–ƒâ–ƒâ–„â–…â–ƒâ–â–â–â–â–â–ƒâ–†â–‡ â–ˆ
  1.31 Î¼s<span class="sgr90">      Histogram: <span class="sgr1">log(</span>frequency<span class="sgr1">)</span> by time</span>      2.04 Î¼s <span class="sgr1">&lt;</span>

 Memory estimate<span class="sgr90">: </span><span class="sgr33">0 bytes</span>, allocs estimate<span class="sgr90">: </span><span class="sgr33">0</span>.
D_sparse
BenchmarkTools.Trial: 10000 samples with 9 evaluations per sample.
 Range <span class="sgr90">(</span><span class="sgr36"><span class="sgr1">min</span></span> â€¦ <span class="sgr35">max</span><span class="sgr90">):  </span><span class="sgr36"><span class="sgr1">2.353 Î¼s</span></span> â€¦ <span class="sgr35">  4.921 Î¼s</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>min â€¦ max<span class="sgr90">): </span>0.00% â€¦ 0.00%
 Time  <span class="sgr90">(</span><span class="sgr34"><span class="sgr1">median</span></span><span class="sgr90">):     </span><span class="sgr34"><span class="sgr1">2.403 Î¼s               </span></span><span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>median<span class="sgr90">):    </span>0.00%
 Time  <span class="sgr90">(</span><span class="sgr32"><span class="sgr1">mean</span></span> Â± <span class="sgr32">Ïƒ</span><span class="sgr90">):   </span><span class="sgr32"><span class="sgr1">2.427 Î¼s</span></span> Â± <span class="sgr32">143.606 ns</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>mean Â± Ïƒ<span class="sgr90">):  </span>0.00% Â± 0.00%

  â–â–†â–ˆ<span class="sgr34">â–ˆ</span>â–‡<span class="sgr32">â–†</span>â–ƒ                                                  â–  â–‚
  â–ˆâ–ˆâ–ˆ<span class="sgr34">â–ˆ</span>â–ˆ<span class="sgr32">â–ˆ</span>â–ˆâ–ˆâ–†â–ƒâ–â–â–â–â–ƒâ–ƒâ–…â–…â–…â–…â–„â–ƒâ–â–â–â–â–â–â–â–â–â–â–â–â–â–ƒâ–â–â–ƒâ–†â–ˆâ–„â–„â–â–â–â–â–ƒâ–â–â–ƒâ–â–â–ƒâ–†â–†â–ˆâ–ˆâ–ˆ â–ˆ
  2.35 Î¼s<span class="sgr90">      Histogram: <span class="sgr1">log(</span>frequency<span class="sgr1">)</span> by time</span>      3.21 Î¼s <span class="sgr1">&lt;</span>

 Memory estimate<span class="sgr90">: </span><span class="sgr33">0 bytes</span>, allocs estimate<span class="sgr90">: </span><span class="sgr33">0</span>.
D_full
BenchmarkTools.Trial: 10000 samples with 3 evaluations per sample.
 Range <span class="sgr90">(</span><span class="sgr36"><span class="sgr1">min</span></span> â€¦ <span class="sgr35">max</span><span class="sgr90">):  </span><span class="sgr36"><span class="sgr1">8.970 Î¼s</span></span> â€¦ <span class="sgr35"> 17.562 Î¼s</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>min â€¦ max<span class="sgr90">): </span>0.00% â€¦ 0.00%
 Time  <span class="sgr90">(</span><span class="sgr34"><span class="sgr1">median</span></span><span class="sgr90">):     </span><span class="sgr34"><span class="sgr1">9.020 Î¼s               </span></span><span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>median<span class="sgr90">):    </span>0.00%
 Time  <span class="sgr90">(</span><span class="sgr32"><span class="sgr1">mean</span></span> Â± <span class="sgr32">Ïƒ</span><span class="sgr90">):   </span><span class="sgr32"><span class="sgr1">9.110 Î¼s</span></span> Â± <span class="sgr32">499.406 ns</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>mean Â± Ïƒ<span class="sgr90">):  </span>0.00% Â± 0.00%

  â–‡<span class="sgr34">â–ˆ</span>â–„<span class="sgr32"> </span>                                                    â–â–  â–
  â–ˆ<span class="sgr34">â–ˆ</span>â–ˆ<span class="sgr32">â–‡</span>â–…â–„â–†â–‡â–ƒâ–â–â–ƒâ–â–â–…â–…â–…â–…â–ƒâ–„â–â–ƒâ–ƒâ–ƒâ–â–â–â–â–ƒâ–â–ƒâ–â–â–â–ƒâ–â–â–â–â–â–â–â–â–â–â–â–â–â–â–ƒâ–â–â–â–‡â–†â–‡â–ˆâ–ˆâ–ˆ â–ˆ
  8.97 Î¼s<span class="sgr90">      Histogram: <span class="sgr1">log(</span>frequency<span class="sgr1">)</span> by time</span>      11.5 Î¼s <span class="sgr1">&lt;</span>

 Memory estimate<span class="sgr90">: </span><span class="sgr33">0 bytes</span>, allocs estimate<span class="sgr90">: </span><span class="sgr33">0</span>.</code></pre><p>Now, we use an array of structures (AoS) based on <code>reinterpret</code> and standard <code>mul!</code>. This is much more efficient for the implementation in SummationByPartsOperators.jl. In Julia v1.6, this is also more efficient for sparse matrices but less efficient for dense matrices (compared to the plain AoS approach with <code>mul_aos!</code> above).</p><pre><code class="language-julia hljs">println(&quot;Array of Structures (reinterpreted array)&quot;)
u_aos_r = reinterpret(reshape, Vec5{T}, u_aos_plain); du_aos_r = similar(u_aos_r)
@show D_SBP * u_aos_r â‰ˆ D_sparse * u_aos_r â‰ˆ D_full * u_aos_r
mul!(du_aos_r, D_SBP, u_aos_r)
@show reinterpret(reshape, T, du_aos_r) â‰ˆ du_aos_plain
println(&quot;D_SBP&quot;)
show(stdout, MIME&quot;text/plain&quot;(), @benchmark mul!($du_aos_r, $D_SBP, $u_aos_r))
println(&quot;\nD_sparse&quot;)
show(stdout, MIME&quot;text/plain&quot;(), @benchmark mul!($du_aos_r, $D_sparse, $u_aos_r))
println(&quot;\nD_full&quot;)
show(stdout, MIME&quot;text/plain&quot;(), @benchmark mul!($du_aos_r, $D_full, $u_aos_r))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Array of Structures (reinterpreted array)
D_SBP * u_aos_r â‰ˆ D_sparse * u_aos_r â‰ˆ D_full * u_aos_r = true
reinterpret(reshape, T, du_aos_r) â‰ˆ du_aos_plain = true
D_SBP
BenchmarkTools.Trial: 10000 samples with 555 evaluations per sample.
 Range <span class="sgr90">(</span><span class="sgr36"><span class="sgr1">min</span></span> â€¦ <span class="sgr35">max</span><span class="sgr90">):  </span><span class="sgr36"><span class="sgr1">207.845 ns</span></span> â€¦ <span class="sgr35">366.932 ns</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>min â€¦ max<span class="sgr90">): </span>0.00% â€¦ 0.00%
 Time  <span class="sgr90">(</span><span class="sgr34"><span class="sgr1">median</span></span><span class="sgr90">):     </span><span class="sgr34"><span class="sgr1">211.474 ns               </span></span><span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>median<span class="sgr90">):    </span>0.00%
 Time  <span class="sgr90">(</span><span class="sgr32"><span class="sgr1">mean</span></span> Â± <span class="sgr32">Ïƒ</span><span class="sgr90">):   </span><span class="sgr32"><span class="sgr1">213.503 ns</span></span> Â± <span class="sgr32">  6.789 ns</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>mean Â± Ïƒ<span class="sgr90">):  </span>0.00% Â± 0.00%

    â–„â–…â–…â–†â–ˆ<span class="sgr34">â–ˆ</span>â–‡â–…â–ƒ<span class="sgr32">â–‚</span>                 â–â–â–‚â–„â–„â–ƒâ–‚â–                         â–‚
  â–„â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ<span class="sgr34">â–ˆ</span>â–ˆâ–ˆâ–ˆ<span class="sgr32">â–ˆ</span>â–ˆâ–ˆâ–ˆâ–ˆâ–†â–†â–…â–†â–„â–â–„â–…â–„â–„â–„â–†â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‡â–‡â–†â–…â–†â–…â–…â–…â–„â–„â–…â–†â–†â–†â–†â–‡â–‡â–‡â–‡â–†â–†â–†â–… â–ˆ
  208 ns<span class="sgr90">        Histogram: <span class="sgr1">log(</span>frequency<span class="sgr1">)</span> by time</span>        238 ns <span class="sgr1">&lt;</span>

 Memory estimate<span class="sgr90">: </span><span class="sgr33">0 bytes</span>, allocs estimate<span class="sgr90">: </span><span class="sgr33">0</span>.
D_sparse
BenchmarkTools.Trial: 10000 samples with 180 evaluations per sample.
 Range <span class="sgr90">(</span><span class="sgr36"><span class="sgr1">min</span></span> â€¦ <span class="sgr35">max</span><span class="sgr90">):  </span><span class="sgr36"><span class="sgr1">585.361 ns</span></span> â€¦ <span class="sgr35"> 1.062 Î¼s</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>min â€¦ max<span class="sgr90">): </span>0.00% â€¦ 0.00%
 Time  <span class="sgr90">(</span><span class="sgr34"><span class="sgr1">median</span></span><span class="sgr90">):     </span><span class="sgr34"><span class="sgr1">594.544 ns              </span></span><span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>median<span class="sgr90">):    </span>0.00%
 Time  <span class="sgr90">(</span><span class="sgr32"><span class="sgr1">mean</span></span> Â± <span class="sgr32">Ïƒ</span><span class="sgr90">):   </span><span class="sgr32"><span class="sgr1">600.845 ns</span></span> Â± <span class="sgr32">24.628 ns</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>mean Â± Ïƒ<span class="sgr90">):  </span>0.00% Â± 0.00%

      â–„â–ˆ<span class="sgr34">â–†</span>   <span class="sgr32"> </span>                                                  
  â–‚â–‚â–ƒâ–…â–ˆâ–ˆ<span class="sgr34">â–ˆ</span>â–ˆâ–…â–ƒ<span class="sgr32">â–‚</span>â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–â–‚â–â–‚â–‚â–â–â–‚â–‚â–‚â–ƒâ–ƒâ–ƒâ–ƒâ–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚ â–ƒ
  585 ns<span class="sgr90">          Histogram: frequency by time</span>          677 ns <span class="sgr1">&lt;</span>

 Memory estimate<span class="sgr90">: </span><span class="sgr33">0 bytes</span>, allocs estimate<span class="sgr90">: </span><span class="sgr33">0</span>.
D_full
BenchmarkTools.Trial: 10000 samples with 4 evaluations per sample.
 Range <span class="sgr90">(</span><span class="sgr36"><span class="sgr1">min</span></span> â€¦ <span class="sgr35">max</span><span class="sgr90">):  </span><span class="sgr36"><span class="sgr1">7.173 Î¼s</span></span> â€¦ <span class="sgr35"> 21.848 Î¼s</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>min â€¦ max<span class="sgr90">): </span>0.00% â€¦ 0.00%
 Time  <span class="sgr90">(</span><span class="sgr34"><span class="sgr1">median</span></span><span class="sgr90">):     </span><span class="sgr34"><span class="sgr1">7.223 Î¼s               </span></span><span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>median<span class="sgr90">):    </span>0.00%
 Time  <span class="sgr90">(</span><span class="sgr32"><span class="sgr1">mean</span></span> Â± <span class="sgr32">Ïƒ</span><span class="sgr90">):   </span><span class="sgr32"><span class="sgr1">7.354 Î¼s</span></span> Â± <span class="sgr32">825.307 ns</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>mean Â± Ïƒ<span class="sgr90">):  </span>0.00% Â± 0.00%

  â–ˆ<span class="sgr34">â–…</span> <span class="sgr32">â–</span>                        â–                               â–
  â–ˆ<span class="sgr34">â–ˆ</span>â–…<span class="sgr32">â–ˆ</span>â–†â–„â–â–…â–‡â–„â–„â–ƒâ–„â–â–„â–â–â–â–â–â–â–â–ƒâ–„â–ƒâ–„â–…â–ˆâ–ˆâ–ˆâ–†â–†â–…â–„â–„â–„â–„â–„â–ƒâ–ƒâ–â–â–„â–â–„â–â–â–ƒâ–â–ƒâ–ƒâ–ƒâ–ƒâ–â–ƒâ–â–ƒâ–„â–„ â–ˆ
  7.17 Î¼s<span class="sgr90">      Histogram: <span class="sgr1">log(</span>frequency<span class="sgr1">)</span> by time</span>      11.1 Î¼s <span class="sgr1">&lt;</span>

 Memory estimate<span class="sgr90">: </span><span class="sgr33">0 bytes</span>, allocs estimate<span class="sgr90">: </span><span class="sgr33">0</span>.</code></pre><p>Next, we still use an array of structures (AoS), but copy the data into a plain <code>Array</code> instead of using the <code>reinterpret</code>ed versions. There is no significant difference to the previous version in this case.</p><pre><code class="language-julia hljs">println(&quot;Array of Structures&quot;)
u_aos = Array(u_aos_r); du_aos = similar(u_aos)
@show D_SBP * u_aos â‰ˆ D_sparse * u_aos â‰ˆ D_full * u_aos
mul!(du_aos, D_SBP, u_aos)
@show du_aos â‰ˆ du_aos_r
println(&quot;D_SBP&quot;)
show(stdout, MIME&quot;text/plain&quot;(), @benchmark mul!($du_aos, $D_SBP, $u_aos))
println(&quot;\nD_sparse&quot;)
show(stdout, MIME&quot;text/plain&quot;(), @benchmark mul!($du_aos, $D_sparse, $u_aos))
println(&quot;\nD_full&quot;)
show(stdout, MIME&quot;text/plain&quot;(), @benchmark mul!($du_aos, $D_full, $u_aos))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Array of Structures
D_SBP * u_aos â‰ˆ D_sparse * u_aos â‰ˆ D_full * u_aos = true
du_aos â‰ˆ du_aos_r = true
D_SBP
BenchmarkTools.Trial: 10000 samples with 565 evaluations per sample.
 Range <span class="sgr90">(</span><span class="sgr36"><span class="sgr1">min</span></span> â€¦ <span class="sgr35">max</span><span class="sgr90">):  </span><span class="sgr36"><span class="sgr1">205.673 ns</span></span> â€¦ <span class="sgr35">991.308 ns</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>min â€¦ max<span class="sgr90">): </span>0.00% â€¦ 0.00%
 Time  <span class="sgr90">(</span><span class="sgr34"><span class="sgr1">median</span></span><span class="sgr90">):     </span><span class="sgr34"><span class="sgr1">208.742 ns               </span></span><span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>median<span class="sgr90">):    </span>0.00%
 Time  <span class="sgr90">(</span><span class="sgr32"><span class="sgr1">mean</span></span> Â± <span class="sgr32">Ïƒ</span><span class="sgr90">):   </span><span class="sgr32"><span class="sgr1">211.187 ns</span></span> Â± <span class="sgr32"> 13.566 ns</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>mean Â± Ïƒ<span class="sgr90">):  </span>0.00% Â± 0.00%

    â–ƒâ–‡â–ˆ<span class="sgr34">â–‡</span>â–…â–ƒ<span class="sgr32">â–</span>â–            â–ƒâ–„â–„â–‚â–                                   â–‚
  â–ƒâ–†â–ˆâ–ˆâ–ˆ<span class="sgr34">â–ˆ</span>â–ˆâ–ˆ<span class="sgr32">â–ˆ</span>â–ˆâ–ˆâ–‡â–…â–â–â–„â–â–ƒâ–†â–â–ƒâ–‡â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–†â–†â–„â–â–…â–â–â–…â–…â–†â–†â–‡â–…â–…â–†â–â–…â–„â–„â–ƒâ–â–ƒâ–â–â–ƒâ–…â–†â–ƒâ–…â–„â–ƒâ–„â–… â–ˆ
  206 ns<span class="sgr90">        Histogram: <span class="sgr1">log(</span>frequency<span class="sgr1">)</span> by time</span>        246 ns <span class="sgr1">&lt;</span>

 Memory estimate<span class="sgr90">: </span><span class="sgr33">0 bytes</span>, allocs estimate<span class="sgr90">: </span><span class="sgr33">0</span>.
D_sparse
BenchmarkTools.Trial: 10000 samples with 181 evaluations per sample.
 Range <span class="sgr90">(</span><span class="sgr36"><span class="sgr1">min</span></span> â€¦ <span class="sgr35">max</span><span class="sgr90">):  </span><span class="sgr36"><span class="sgr1">582.735 ns</span></span> â€¦ <span class="sgr35"> 2.579 Î¼s</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>min â€¦ max<span class="sgr90">): </span>0.00% â€¦ 0.00%
 Time  <span class="sgr90">(</span><span class="sgr34"><span class="sgr1">median</span></span><span class="sgr90">):     </span><span class="sgr34"><span class="sgr1">592.260 ns              </span></span><span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>median<span class="sgr90">):    </span>0.00%
 Time  <span class="sgr90">(</span><span class="sgr32"><span class="sgr1">mean</span></span> Â± <span class="sgr32">Ïƒ</span><span class="sgr90">):   </span><span class="sgr32"><span class="sgr1">600.023 ns</span></span> Â± <span class="sgr32">44.333 ns</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>mean Â± Ïƒ<span class="sgr90">):  </span>0.00% Â± 0.00%

      â–„â–ˆ<span class="sgr34">â–…</span>     <span class="sgr32"> </span>                                                
  â–‚â–‚â–ƒâ–†â–ˆâ–ˆ<span class="sgr34">â–ˆ</span>â–ˆâ–…â–„â–ƒâ–„<span class="sgr32">â–„</span>â–ƒâ–ƒâ–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–â–‚â–‚â–‚â–ƒâ–ƒâ–ƒâ–ƒâ–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–â–‚â–‚â–‚â–â–‚â–‚â–‚â–â–‚â–â–‚â–‚â–‚â–‚ â–ƒ
  583 ns<span class="sgr90">          Histogram: frequency by time</span>          673 ns <span class="sgr1">&lt;</span>

 Memory estimate<span class="sgr90">: </span><span class="sgr33">0 bytes</span>, allocs estimate<span class="sgr90">: </span><span class="sgr33">0</span>.
D_full
BenchmarkTools.Trial: 10000 samples with 4 evaluations per sample.
 Range <span class="sgr90">(</span><span class="sgr36"><span class="sgr1">min</span></span> â€¦ <span class="sgr35">max</span><span class="sgr90">):  </span><span class="sgr36"><span class="sgr1">7.484 Î¼s</span></span> â€¦ <span class="sgr35"> 29.086 Î¼s</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>min â€¦ max<span class="sgr90">): </span>0.00% â€¦ 0.00%
 Time  <span class="sgr90">(</span><span class="sgr34"><span class="sgr1">median</span></span><span class="sgr90">):     </span><span class="sgr34"><span class="sgr1">7.549 Î¼s               </span></span><span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>median<span class="sgr90">):    </span>0.00%
 Time  <span class="sgr90">(</span><span class="sgr32"><span class="sgr1">mean</span></span> Â± <span class="sgr32">Ïƒ</span><span class="sgr90">):   </span><span class="sgr32"><span class="sgr1">7.652 Î¼s</span></span> Â± <span class="sgr32">687.726 ns</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>mean Â± Ïƒ<span class="sgr90">):  </span>0.00% Â± 0.00%

  â–…â–ˆ<span class="sgr34">â–‡</span>â–ƒ <span class="sgr32"> </span> â–                                           â–â–â–      â–‚
  â–ˆâ–ˆ<span class="sgr34">â–ˆ</span>â–ˆâ–…<span class="sgr32">â–…</span>â–ˆâ–ˆâ–†â–ƒâ–â–â–â–ƒâ–†â–†â–†â–‡â–†â–…â–…â–ƒâ–â–â–ƒâ–â–â–â–â–â–ƒâ–ƒâ–„â–â–„â–â–â–â–ƒâ–ƒâ–â–â–ƒâ–ƒâ–â–â–â–ƒâ–â–„â–‡â–ˆâ–ˆâ–ˆâ–‡â–‡â–†â–†â–… â–ˆ
  7.48 Î¼s<span class="sgr90">      Histogram: <span class="sgr1">log(</span>frequency<span class="sgr1">)</span> by time</span>      9.56 Î¼s <span class="sgr1">&lt;</span>

 Memory estimate<span class="sgr90">: </span><span class="sgr33">0 bytes</span>, allocs estimate<span class="sgr90">: </span><span class="sgr33">0</span>.</code></pre><p>Finally, let&#39;s look at a structure of arrays (SoA). Interestingly, this is slower than the array of structures we used above. On Julia v1.6, the sparse matrix representation performs particularly bad in this case.</p><pre><code class="language-julia hljs">println(&quot;Structure of Arrays&quot;)
u_soa = StructArray(u_aos); du_soa = similar(u_soa)
@show D_SBP * u_soa â‰ˆ D_sparse * u_soa â‰ˆ D_full * u_soa
mul!(du_soa, D_SBP, u_soa)
@show du_soa â‰ˆ du_aos
println(&quot;D_SBP&quot;)
show(stdout, MIME&quot;text/plain&quot;(), @benchmark mul!($du_soa, $D_SBP, $u_soa))
println(&quot;\nD_sparse&quot;)
show(stdout, MIME&quot;text/plain&quot;(), @benchmark mul!($du_soa, $D_sparse, $u_soa))
println(&quot;\nD_full&quot;)
show(stdout, MIME&quot;text/plain&quot;(), @benchmark mul!($du_soa, $D_full, $u_soa))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Structure of Arrays
D_SBP * u_soa â‰ˆ D_sparse * u_soa â‰ˆ D_full * u_soa = true
du_soa â‰ˆ du_aos = true
D_SBP
BenchmarkTools.Trial: 10000 samples with 478 evaluations per sample.
 Range <span class="sgr90">(</span><span class="sgr36"><span class="sgr1">min</span></span> â€¦ <span class="sgr35">max</span><span class="sgr90">):  </span><span class="sgr36"><span class="sgr1">221.686 ns</span></span> â€¦ <span class="sgr35">378.295 ns</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>min â€¦ max<span class="sgr90">): </span>0.00% â€¦ 0.00%
 Time  <span class="sgr90">(</span><span class="sgr34"><span class="sgr1">median</span></span><span class="sgr90">):     </span><span class="sgr34"><span class="sgr1">224.013 ns               </span></span><span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>median<span class="sgr90">):    </span>0.00%
 Time  <span class="sgr90">(</span><span class="sgr32"><span class="sgr1">mean</span></span> Â± <span class="sgr32">Ïƒ</span><span class="sgr90">):   </span><span class="sgr32"><span class="sgr1">226.628 ns</span></span> Â± <span class="sgr32">  9.738 ns</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>mean Â± Ïƒ<span class="sgr90">):  </span>0.00% Â± 0.00%

  â–„â–ˆ<span class="sgr34">â–ˆ</span>â–†â–‚<span class="sgr32">â–</span>â–        â–„â–„â–‚                                            â–‚
  â–ˆâ–ˆ<span class="sgr34">â–ˆ</span>â–ˆâ–ˆ<span class="sgr32">â–ˆ</span>â–ˆâ–†â–„â–„â–„â–â–ƒâ–ƒâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‡â–‡â–‡â–…â–…â–„â–â–…â–…â–â–ƒâ–ƒâ–ƒâ–„â–…â–ƒâ–„â–ƒâ–„â–„â–â–…â–â–„â–â–â–â–„â–ƒâ–ƒâ–â–â–â–ƒâ–ƒâ–â–„â–â–â–â–ƒâ–„ â–ˆ
  222 ns<span class="sgr90">        Histogram: <span class="sgr1">log(</span>frequency<span class="sgr1">)</span> by time</span>        287 ns <span class="sgr1">&lt;</span>

 Memory estimate<span class="sgr90">: </span><span class="sgr33">0 bytes</span>, allocs estimate<span class="sgr90">: </span><span class="sgr33">0</span>.
D_sparse
BenchmarkTools.Trial: 10000 samples with 1 evaluation per sample.
 Range <span class="sgr90">(</span><span class="sgr36"><span class="sgr1">min</span></span> â€¦ <span class="sgr35">max</span><span class="sgr90">):  </span><span class="sgr36"><span class="sgr1">211.873 Î¼s</span></span> â€¦ <span class="sgr35">  6.382 ms</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>min â€¦ max<span class="sgr90">): </span>0.00% â€¦ 62.02%
 Time  <span class="sgr90">(</span><span class="sgr34"><span class="sgr1">median</span></span><span class="sgr90">):     </span><span class="sgr34"><span class="sgr1">221.210 Î¼s               </span></span><span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>median<span class="sgr90">):    </span>0.00%
 Time  <span class="sgr90">(</span><span class="sgr32"><span class="sgr1">mean</span></span> Â± <span class="sgr32">Ïƒ</span><span class="sgr90">):   </span><span class="sgr32"><span class="sgr1">247.027 Î¼s</span></span> Â± <span class="sgr32">299.088 Î¼s</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>mean Â± Ïƒ<span class="sgr90">):  </span>8.74% Â±  6.87%

   â–„â–†â–ˆ<span class="sgr34">â–†</span>â–„â–…â–†â–ƒâ–    <span class="sgr32"> </span>                                               â–‚
  â–‡â–ˆâ–ˆâ–ˆ<span class="sgr34">â–ˆ</span>â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‡â–‡â–‡â–‡<span class="sgr32">â–…</span>â–…â–…â–…â–†â–…â–„â–…â–„â–…â–„â–…â–…â–„â–„â–„â–ƒâ–â–â–„â–â–â–â–â–â–ƒâ–ƒâ–â–ƒâ–â–â–â–â–â–ƒâ–ƒâ–â–â–â–â–â–„â–†â–‡â–‡â–‡â–† â–ˆ
  212 Î¼s<span class="sgr90">        Histogram: <span class="sgr1">log(</span>frequency<span class="sgr1">)</span> by time</span>        363 Î¼s <span class="sgr1">&lt;</span>

 Memory estimate<span class="sgr90">: </span><span class="sgr33">328.25 KiB</span>, allocs estimate<span class="sgr90">: </span><span class="sgr33">10504</span>.
D_full
BenchmarkTools.Trial: 10000 samples with 1 evaluation per sample.
 Range <span class="sgr90">(</span><span class="sgr36"><span class="sgr1">min</span></span> â€¦ <span class="sgr35">max</span><span class="sgr90">):  </span><span class="sgr36"><span class="sgr1">177.028 Î¼s</span></span> â€¦ <span class="sgr35">  4.542 ms</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>min â€¦ max<span class="sgr90">): </span> 0.00% â€¦ 93.62%
 Time  <span class="sgr90">(</span><span class="sgr34"><span class="sgr1">median</span></span><span class="sgr90">):     </span><span class="sgr34"><span class="sgr1">186.236 Î¼s               </span></span><span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>median<span class="sgr90">):    </span> 0.00%
 Time  <span class="sgr90">(</span><span class="sgr32"><span class="sgr1">mean</span></span> Â± <span class="sgr32">Ïƒ</span><span class="sgr90">):   </span><span class="sgr32"><span class="sgr1">210.355 Î¼s</span></span> Â± <span class="sgr32">291.538 Î¼s</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>mean Â± Ïƒ<span class="sgr90">):  </span>10.03% Â±  6.90%

     â–ˆ<span class="sgr34">â–</span>         <span class="sgr32"> </span>                                               
  â–ƒâ–†â–‡â–ˆ<span class="sgr34">â–ˆ</span>â–ƒâ–ƒâ–†â–ƒâ–‚â–‚â–‚â–‚â–‚<span class="sgr32">â–‚</span>â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–â–‚â–â–‚â–â–â–‚â–â–â–‚â–‚â–â–‚â–â–â–‚â–â–â–â–â–‚â–â–â–â–â–â–‚â–‚â–‚â–‚â–‚ â–‚
  177 Î¼s<span class="sgr90">           Histogram: frequency by time</span>          323 Î¼s <span class="sgr1">&lt;</span>

 Memory estimate<span class="sgr90">: </span><span class="sgr33">328.25 KiB</span>, allocs estimate<span class="sgr90">: </span><span class="sgr33">10504</span>.</code></pre><p>These results were obtained using the following versions.</p><pre><code class="language-julia hljs">using InteractiveUtils
versioninfo()

using Pkg
Pkg.status([&quot;SummationByPartsOperators&quot;, &quot;StaticArrays&quot;, &quot;StructArrays&quot;],
           mode=PKGMODE_MANIFEST)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Julia Version 1.6.7
Commit 3b76b25b64 (2022-07-19 15:11 UTC)
Platform Info:
  OS: Linux (x86_64-pc-linux-gnu)
  CPU: AMD EPYC 7763 64-Core Processor
  WORD_SIZE: 64
  LIBM: libopenlibm
  LLVM: libLLVM-11.0.1 (ORCJIT, generic)
Environment:
  JULIA_PKG_SERVER_REGISTRY_PREFERENCE = eager
<span class="sgr32"><span class="sgr1">      Status</span></span> `~/work/SummationByPartsOperators.jl/SummationByPartsOperators.jl/docs/Manifest.toml`
 <span class="sgr90"> [90137ffa] </span>StaticArrays v1.9.13
 <span class="sgr90"> [09ab397b] </span>StructArrays v0.6.18
 <span class="sgr90"> [9f78cca6] </span>SummationByPartsOperators v0.5.78 `~/work/SummationByPartsOperators.jl/SummationByPartsOperators.jl`</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../applications/">Â« Applications &amp; references</a><a class="docs-footer-nextpage" href="../api_reference/">API reference Â»</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.9.0 on <span class="colophon-date" title="Thursday 20 March 2025 10:16">Thursday 20 March 2025</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
